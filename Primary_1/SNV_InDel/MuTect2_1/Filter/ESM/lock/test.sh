####################################################################################################################
####################################################################################################################
# Filter SNV-InDels with ESM after excluding technical error and unwanted types of variants.
# Author: Haiying Kong
# Last Modified: 25 August 2021
####################################################################################################################
####################################################################################################################
#!/bin/bash -i

####################################################################################################################
####################################################################################################################
# Get batch name and number of thread from argument passing.
dir_name=PTH
batch=Primary_001
scheme_name=ESM

####################################################################################################################
####################################################################################################################
# Define directory for the batch.
batch_dir=/home/projects/cu_10184/projects/${dir_name}/BatchWork_1/${batch}

# Change to working directory.
temp_dir=${batch_dir}/temp
cd ${temp_dir}

####################################################################################################################
####################################################################################################################
# Get maf file names.
cd ${batch_dir}/Lock/SNV_InDel/MuTect2_1/maf
count=`ls -1 *.maf 2>/dev/null | wc -l`

if [[ $count = 0 ]]
then 
  exit
fi

maf_files=($(ls *.maf))

####################################################################################################################
# Change to working directory.
cd ${temp_dir}

####################################################################################################################
# Get sample names.
samples=($(echo ${maf_files[@]%.maf} | tr ' ' '\n' | sort -u | tr '\n' ' '))

####################################################################################################################
# Run pipeline on all samples in this batch.
####################################################################################################################
for sam in ${samples[0]}  # ${samples[@]}
do
  qsub -o  /home/projects/cu_10184/projects/PTH/Code/Primary_1/SNV_InDel/MuTect2_1/Filter/${scheme_name}/${sam}.log -e  /home/projects/cu_10184/projects/PTH/Code/Primary_1/SNV_InDel/MuTect2_1/Filter/${scheme_name}/${sam}.error -N test  \
    -l nodes=1:ppn=8,mem=20gb,walltime=1:00:00  \
    -v dir_name=${dir_name},batch=${batch},sam=${sam},temp_dir=${temp_dir}  \
    /home/projects/cu_10184/projects/PTH/Code/Primary_1/SNV_InDel/MuTect2_1/Filter/${scheme_name}/test_job.sh
done

####################################################################################################################
####################################################################################################################
